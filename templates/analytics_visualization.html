<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Visualization</title>

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        // the JSON data is provided when the HTML is generated from this template.
        var tempData = {{ .StrData }};
        var packetLoss = tempData.packet_loss;
        var latency = tempData.latency;
        var jitter = tempData.jitter;
        var frameRate = tempData.frame_rate;

        google.charts.load('current', { 'packages': ['line'] });
        google.charts.setOnLoadCallback(drawGraph("Packet Loss", packetLoss, "packet_loss")); // packet_loss
        google.charts.setOnLoadCallback(drawGraph("Latency", latency, "latency")); // latency
        google.charts.setOnLoadCallback(drawGraph("Jitter", jitter, "jitter")); // jitter

        var counter = 0;
        function drawGraph(title, values, div) {
            return function () {
                if (values === undefined || values.length == 0) {
                    return
                }
                var data = new google.visualization.DataTable();
                data.addColumn('number', 'Time Series Entry');
                data.addColumn('number', title);

                for (let i = 0; i < values.length; i++) {
                    data.addRow([i + 1, values[i]])
                }

                var options = {
                    chart: {
                        title: `Data: ${title}`
                    },
                    width: 1000,
                    height: 700
                };

                var graph = new google.charts.Line(document.getElementById(div));
                graph.draw(data, google.charts.Line.convertOptions(options));
            }
        }
    </script>
</head>

<body>
    <section>
        <p>Try other data:</p>
        <ul>
            {{ if ne .Actual.DataPoint "audio_in" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=audio_in">Visualize 'Audio In'</a></li>
            {{end}}

            {{ if ne .Actual.DataPoint "audio_out" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=audio_out">Visualize 'Audio Out'</a></li>
            {{end}}

            {{ if ne .Actual.DataPoint "video_in" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=video_in">Visualize 'Video In'</a></li>
            {{end}}

            {{ if ne .Actual.DataPoint "video_out" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=video_out">Visualize 'Video Out'</a></li>
            {{end}}

            {{ if ne .Actual.DataPoint "share_in" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=share_in">Visualize 'Share In'</a></li>
            {{end}}

            {{ if ne .Actual.DataPoint "share_out" }}
            <li><a href="/get_analytics_page?id={{ .Actual.MeetingID }}&dp=share_out">Visualize 'Share Out'</a></li>
            {{end}}
        </ul>
    </section>
    <!--Divs that will hold the graphs-->
    <h1 id="title"> {{ .Actual.DataPoint }}, duration is between {{ .Actual.StartTime}} - {{ .Actual.EndTime }}</h1>
    <div id="packet_loss"></div>
    <div id="latency"></div>
    <div id="jitter"></div>
</body>

</html>