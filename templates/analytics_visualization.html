<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Visualization</title>

    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
        // the JSON data is provided when the HTML is generated from this template.
        var analytics = {{ .Data }};
        google.charts.load('current', { 'packages': ['line'] });
        // iterate over sessions
        for (var i = 0; i < analytics.sessions.length; i++) {
            google.charts.setOnLoadCallback(drawGraph(analytics.sessions[i], i + 1));
        }

        function drawGraph(session, count) {
            return function () {
                var data = new google.visualization.DataTable();
                data.addColumn('number', 'Time Series Entry');
                data.addColumn('number', 'Packet Loss');
                data.addColumn('number', 'Latency');
                data.addColumn('number', 'Jitter');

                for (let j = 0; j < session.latency.length; j++) {
                    data.addRow([j + 1, session.packet_loss[j], session.latency[j], session.jitter[j]]);
                }

                var options = {
                    chart: {
                        title: `Data from ${session.start_time} to ${session.end_time}`,
                    },
                    width: 1000,
                    height: 700
                };

                var graph = new google.charts.Line(document.getElementById('session_' + count));
                graph.draw(data, google.charts.Line.convertOptions(options));
            }
        }
    </script>
</head>

<body>
    <section>
        <p>Try other data:</p>
        <ul>
            {{ if ne .DataPoint "audio_in" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=audio_in">Visualize 'Audio In'</a></li>
            {{end}}

            {{ if ne .DataPoint "audio_out" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=audio_out">Visualize 'Audio Out'</a></li>
            {{end}}

            {{ if ne .DataPoint "video_in" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=video_in">Visualize 'Video In'</a></li>
            {{end}}

            {{ if ne .DataPoint "video_out" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=video_out">Visualize 'Video Out'</a></li>
            {{end}}

            {{ if ne .DataPoint "share_in" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=share_in">Visualize 'Share In'</a></li>
            {{end}}

            {{ if ne .DataPoint "share_out" }}
            <li><a href="/get_analytics_page?id={{ .MeetingID }}&dp=share_out">Visualize 'Share Out'</a></li>
            {{end}}
        </ul>
    </section>
    <!--Divs that will hold the graphs-->
    <h1 id="title" style="text-align: center;"> Data for {{ .DataPoint }} from {{ .MeetingID }}</h1>
    {{ range .Sessions}}
    <div id="session_{{.}}"></div>
    {{end}}
</body>

</html>